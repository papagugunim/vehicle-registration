<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ï∞®Îüâ ÏûÖÏ∞® Îì±Î°ù ÏãúÏä§ÌÖú | Lotte KF</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #ED1C24 0%, #C8102E 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 10px;
        }

        .lotte-logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-bottom: 5px;
            font-size: 0.9rem;
            font-weight: 700;
        }

        .lotte-logo img {
            height: 30px;
            width: auto;
        }

        .datetime-display {
            text-align: center;
            background: white;
            color: #333;
            font-size: 0.85rem;
            margin: 8px auto;
            padding: 6px 15px;
            border-radius: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            display: inline-block;
            font-weight: 500;
        }

        .datetime-display .date {
            font-size: 0.9rem;
            font-weight: 700;
            margin-right: 10px;
            color: #ED1C24;
        }

        .datetime-display .time {
            font-size: 0.9rem;
            font-weight: 700;
            color: #333;
        }

        .header h1 {
            font-size: 1.2rem;
            margin-bottom: 4px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .subtitle {
            font-size: 0.75rem;
            opacity: 0.95;
            line-height: 1.2;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 0.95rem;
            font-weight: 700;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .tab-btn.active {
            background: white;
            color: #ED1C24;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        input[type="text"],
        input[type="date"],
        input[type="time"],
        input[type="tel"],
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: #ED1C24;
            box-shadow: 0 0 0 3px rgba(237, 28, 36, 0.1);
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .btn-primary {
            background: #ED1C24;
            color: white;
        }

        .btn-primary:hover {
            background: #C8102E;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(237, 28, 36, 0.4);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-success {
            background: #4caf50;
            color: white;
        }

        .btn-full {
            width: 100%;
        }

        .vehicle-list {
            margin-top: 20px;
        }

        .vehicle-item {
            padding: 15px;
            border: 2px solid #f0f0f0;
            border-radius: 12px;
            margin-bottom: 12px;
            transition: all 0.3s;
        }

        .vehicle-item:hover {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            border-color: #ED1C24;
        }

        .vehicle-item.completed {
            background: #e8f5e9;
            border-color: #4caf50;
        }

        .vehicle-item.pending {
            background: #fff3e0;
            border-color: #ff9800;
        }

        .vehicle-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .vehicle-info {
            flex: 1;
        }

        .vehicle-number {
            font-weight: 700;
            font-size: 1.1rem;
            color: #333;
            margin-bottom: 5px;
        }

        .vehicle-details {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .status-badge {
            padding: 6px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
        }

        .status-completed {
            background: #4caf50;
            color: white;
        }

        .status-pending {
            background: #ff9800;
            color: white;
        }

        .vehicle-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.85rem;
        }

        .btn-secondary {
            background: #757575;
            color: white;
        }

        .btn-danger {
            background: #f44336;
            color: white;
        }

        .search-box {
            margin-bottom: 20px;
        }

        .search-box input {
            width: 100%;
        }

        .filter-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .filter-btn {
            padding: 8px 16px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .filter-btn.active {
            background: #ED1C24;
            color: white;
            border-color: #ED1C24;
        }

        .export-section {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 15px;
        }

        .export-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.3);
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);
        }

        .export-btn:active {
            transform: translateY(0);
        }

        .success-message {
            background: #d4edda;
            border: 2px solid #4caf50;
            color: #155724;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
        }

        .success-message.show {
            display: block;
            animation: fadeIn 0.4s;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }

            .vehicle-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }

        .lang-selector {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 5px;
            background: rgba(255, 255, 255, 0.2);
            padding: 5px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
        }

        .lang-btn {
            padding: 8px 16px;
            border: none;
            background: transparent;
            color: white;
            font-weight: 600;
            cursor: pointer;
            border-radius: 15px;
            transition: all 0.3s;
        }

        .lang-btn.active {
            background: white;
            color: #ED1C24;
        }

        .lang-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .lang-btn.active:hover {
            background: white;
        }

        /* AI Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú ÏòÅÏó≠ */
        .ai-upload-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            margin-bottom: 25px;
            color: white;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .ai-section-header {
            padding: 10px 15px;
            cursor: default;
            display: flex;
            align-items: center;
            justify-content: space-between;
            user-select: none;
        }

        .ai-section-header h3 {
            margin: 0;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ai-toggle-icon {
            display: none;
        }

        .ai-section-content {
            padding: 10px 15px 15px 15px;
            max-height: none;
            overflow: visible;
        }

        .upload-area {
            background: rgba(255, 255, 255, 0.15);
            border: 2px dashed rgba(255, 255, 255, 0.5);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .upload-area:hover {
            background: rgba(255, 255, 255, 0.25);
            border-color: rgba(255, 255, 255, 0.8);
        }

        .upload-area.dragover {
            background: rgba(255, 255, 255, 0.3);
            border-color: white;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 2rem;
            margin-bottom: 8px;
            opacity: 0.9;
        }

        .upload-text {
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .upload-hint {
            font-size: 0.85rem;
            opacity: 0.8;
        }

        #imagePreview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 10px;
            margin-top: 12px;
            display: none;
        }

        .processing-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
            gap: 20px;
        }

        .processing-overlay.show {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .processing-text {
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .btn-clear-image {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border: 1px solid rgba(255, 255, 255, 0.5);
            border-radius: 8px;
            margin-top: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-clear-image:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* AI ÌÉ≠ */
        .ai-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .ai-tab-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }

        .ai-tab-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .ai-tab-btn.active {
            background: rgba(255, 255, 255, 0.3);
            border-color: white;
        }

        .ai-tab-content {
            display: none;
        }

        .ai-tab-content.active {
            display: block;
        }

        #textInput {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 0.9rem;
            font-family: monospace;
            resize: vertical;
        }

        #textInput::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .btn-extract {
            background: white;
            color: #667eea;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
            transition: all 0.3s;
        }

        .btn-extract:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        /* Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄ */
        #loginPage {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .login-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 100%;
        }

        .login-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-header h1 {
            color: #ED1C24;
            font-size: 1.8rem;
            margin-bottom: 10px;
        }

        .login-header p {
            color: #666;
            font-size: 0.9rem;
        }

        .login-form .form-group {
            margin-bottom: 20px;
        }

        .login-form label {
            display: block;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }

        .login-form input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s;
        }

        .login-form input:focus {
            outline: none;
            border-color: #ED1C24;
            box-shadow: 0 0 0 3px rgba(237, 28, 36, 0.1);
        }

        .remember-me {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 20px;
        }

        .remember-me input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .remember-me label {
            margin: 0;
            cursor: pointer;
            font-weight: normal;
        }

        .login-error {
            background: #ffebee;
            color: #c62828;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            text-align: center;
            font-size: 0.9rem;
        }

        .login-error.show {
            display: block;
        }

        .logout-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            backdrop-filter: blur(10px);
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .user-info {
            position: absolute;
            top: 70px;
            left: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
        }

        #mainApp {
            display: none;
        }

        #mainApp.show {
            display: block;
        }
    </style>
</head>

<body>
    <!-- Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄ -->
    <div id="loginPage">
        <!-- Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄ Ïñ∏Ïñ¥ ÏÑ†ÌÉù -->
        <div class="lang-selector">
            <button class="lang-btn active" onclick="switchLanguage('ru')">RUS</button>
            <button class="lang-btn" onclick="switchLanguage('ko')">KOR</button>
        </div>

        <div class="login-card">
            <div class="login-header">
                <div class="lotte-logo" style="justify-content: center; color: #ED1C24;">
                    Happy Moments
                </div>
                <h1 id="loginTitle">üöõ Ï∞®Îüâ ÏûÖÏ∞® Îì±Î°ù ÏãúÏä§ÌÖú</h1>
                <p id="loginSubtitle">Lotte KF Îü¨ÏãúÏïÑÎ≤ïÏù∏</p>
            </div>

            <div class="login-error" id="loginError">
                ÏïÑÏù¥Îîî ÎòêÎäî ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§
            </div>

            <form class="login-form" id="loginForm">
                <div class="form-group">
                    <label for="loginUsername" id="loginUsernameLabel">ÏïÑÏù¥Îîî</label>
                    <input type="text" id="loginUsername" required autocomplete="username">
                </div>

                <div class="form-group">
                    <label for="loginPassword" id="loginPasswordLabel">ÎπÑÎ∞ÄÎ≤àÌò∏</label>
                    <input type="password" id="loginPassword" required autocomplete="current-password">
                </div>

                <div class="remember-me">
                    <input type="checkbox" id="rememberMe">
                    <label for="rememberMe" id="rememberMeLabel">Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú Ïú†ÏßÄ</label>
                </div>

                <button type="submit" class="btn btn-primary btn-full" id="loginBtn">
                    Î°úÍ∑∏Ïù∏
                </button>
            </form>
        </div>
    </div>

    <!-- Î©îÏù∏ Ïï± -->
    <div id="mainApp">
        <div class="container">
            <!-- Î°úÍ∑∏ÏïÑÏõÉ Î≤ÑÌäº -->
            <button class="logout-btn" onclick="logout()">üö™ Î°úÍ∑∏ÏïÑÏõÉ</button>

            <!-- ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ -->
            <div class="user-info" id="userInfo"></div>

            <!-- Ïñ∏Ïñ¥ ÏÑ†ÌÉù -->
            <div class="lang-selector">
                <button class="lang-btn active" onclick="switchLanguage('ru')">RUS</button>
                <button class="lang-btn" onclick="switchLanguage('ko')">KOR</button>
            </div>

            <div class="header">
                <div class="lotte-logo">
                    <img src="logo.png" alt="Lotte Logo" onerror="this.style.display='none'">
                    Happy Moments
                </div>
                <h1>üöõ Ï∞®Îüâ ÏûÖÏ∞® Îì±Î°ù ÏãúÏä§ÌÖú</h1>
                <div class="subtitle">–°–∏—Å—Ç–µ–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤—ä–µ–∑–¥–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ | Vehicle Entry Registration System <span
                        style="font-size: 0.75em; color: #fff; margin-left: 8px;">v0.1</span></div>
                <div class="datetime-display">
                    <span class="date" id="currentDate">Loading...</span>
                    <span class="time" id="currentTime"></span>
                </div>
            </div>

            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('register')">Ï∞®Îüâ Îì±Î°ù</button>
                <button class="tab-btn" onclick="switchTab('list')">Îì±Î°ù ÌòÑÌô©</button>
                <button class="tab-btn" onclick="switchTab('settings')">ÏÑ§Ï†ï</button>
                <button class="tab-btn" id="clientsTabBtn" onclick="window.location.href='clients.html'"
                    style="display: none;">üè¢ Í±∞ÎûòÏ≤ò Í¥ÄÎ¶¨</button>
            </div>

            <!-- Ï∞®Îüâ Îì±Î°ù ÌÉ≠ -->
            <div id="register" class="tab-content active">
                <div class="card">
                    <h2 style="color: #ED1C24; margin-bottom: 20px;">üöõ Ï∞®Îüâ Ï†ïÎ≥¥ Îì±Î°ù</h2>

                    <div class="success-message" id="successMessage">
                        ‚úÖ Ï∞®Îüâ Ï†ïÎ≥¥Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Îì±Î°ùÎêòÏóàÏäµÎãàÎã§!
                    </div>

                    <!-- AI Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú ÏÑπÏÖò -->
                    <div class="ai-upload-section">
                        <!-- Ìó§Îçî -->
                        <div class="ai-section-header">
                            <h3>ü§ñ AI ÏûêÎèô ÏûÖÎ†•</h3>
                        </div>

                        <!-- ÏΩòÌÖêÏ∏† -->
                        <div class="ai-section-content" id="aiSectionContent">
                            <!-- AI ÌÉ≠ -->
                            <div class="ai-tabs">
                                <button type="button" class="ai-tab-btn active" onclick="switchAITab('image')">üì∏ Ïù¥ÎØ∏ÏßÄ
                                    ÏóÖÎ°úÎìú</button>
                                <button type="button" class="ai-tab-btn" onclick="switchAITab('text')">üìù ÌÖçÏä§Ìä∏
                                    Î∂ôÏó¨ÎÑ£Í∏∞</button>
                            </div>

                            <!-- Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú ÌÉ≠ -->
                            <div class="ai-tab-content active" id="imageTab">
                                <div class="upload-area" id="uploadArea">
                                    <input type="file" id="imageInput" accept="image/*" style="display: none;">
                                    <div class="upload-icon">üì∏</div>
                                    <div class="upload-text">ÏúÑÏûÑÏû• Ïù¥ÎØ∏ÏßÄÎ•º ÏóÖÎ°úÎìúÌïòÏÑ∏Ïöî</div>
                                    <div class="upload-hint">ÌÅ¥Î¶≠ÌïòÍ±∞ÎÇò Ïù¥ÎØ∏ÏßÄÎ•º ÎìúÎûòÍ∑∏ÌïòÏÑ∏Ïöî (PNG, JPG, PDF)</div>
                                </div>
                                <img id="imagePreview" alt="Preview">
                                <button type="button" class="btn-clear-image" id="clearImageBtn"
                                    style="display: none;">Ïù¥ÎØ∏ÏßÄ Ï†úÍ±∞</button>
                            </div>

                            <!-- ÌÖçÏä§Ìä∏ Î∂ôÏó¨ÎÑ£Í∏∞ ÌÉ≠ -->
                            <div class="ai-tab-content" id="textTab">
                                <textarea id="textInput"
                                    placeholder="Ïù¥Î©îÏùºÏóêÏÑú Î∞õÏùÄ ÏúÑÏûÑÏû• ÌÖçÏä§Ìä∏Î•º Ïó¨Í∏∞Ïóê Î∂ôÏó¨ÎÑ£ÏúºÏÑ∏Ïöî...&#10;&#10;ÏòàÏãú:&#10;–ì–∞–≤—Ä–∏—Å –î–µ–Ω–∏—Å –í–∏–∫—Ç–æ—Ä–æ–≤–∏—á&#10;–ü–∞—Å–ø–æ—Ä—Ç MC3544098&#10;AX3623-5 / A39101-5&#10;–õ–û–¢–¢–ï"></textarea>
                                <button type="button" class="btn-extract" onclick="extractFromText()">Ï†ïÎ≥¥ Ï∂îÏ∂úÌïòÍ∏∞</button>
                            </div>
                        </div>
                    </div>

                    <form id="vehicleForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="userName">ÏûÖÎ†•Ïûê Ïù¥Î¶Ñ *</label>
                                <select id="userName" required>
                                    <option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="entryDate">ÏûÖÏ∞® ÎÇ†Ïßú *</label>
                                <input type="date" id="entryDate" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="clientName">Í±∞ÎûòÏ≤òÎ™Ö *</label>
                                <input type="text" id="clientName" placeholder="Í±∞ÎûòÏ≤òÎ™Ö ÏûÖÎ†•" required>
                            </div>

                            <div class="form-group">
                                <label for="orderNumber">Ï£ºÎ¨∏Î≤àÌò∏</label>
                                <input type="text" id="orderNumber" placeholder="Ï£ºÎ¨∏Î≤àÌò∏ ÏûÖÎ†•">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="headNumber">Ìó§Îìú Î≤àÌò∏ *</label>
                                <input type="text" id="headNumber" placeholder="Ïª®ÌÖåÏù¥ÎÑà Ìó§Îìú Î≤àÌò∏" required>
                            </div>

                            <div class="form-group">
                                <label for="trailerNumber">Ìä∏Î†àÏùºÎü¨ Î≤àÌò∏ *</label>
                                <input type="text" id="trailerNumber" placeholder="Ìä∏Î†àÏùºÎü¨ Î≤àÌò∏" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="driverName">Ïö¥Ï†ÑÏûê Ïù¥Î¶Ñ *</label>
                                <input type="text" id="driverName" placeholder="Ïö¥Ï†ÑÏûê Ïù¥Î¶Ñ" required>
                            </div>

                            <div class="form-group">
                                <label for="driverPassport">Ïö¥Ï†ÑÏûê Ïó¨Í∂åÎ≤àÌò∏ *</label>
                                <input type="text" id="driverPassport" placeholder="Ïó¨Í∂åÎ≤àÌò∏" required>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="driverPhone">Ïö¥Ï†ÑÏûê Ï†ÑÌôîÎ≤àÌò∏</label>
                                <input type="tel" id="driverPhone" placeholder="+7 XXX XXX XX XX">
                            </div>

                            <div class="form-group">
                                <label for="entryTime">ÏûÖÏ∞® ÏòàÏ†ï ÏãúÍ∞Å</label>
                                <input type="time" id="entryTime" min="08:00" max="20:00">
                            </div>
                        </div>

                        <div class="form-group">
                            <div class="checkbox-group">
                                <input type="checkbox" id="entryCompleted">
                                <label for="entryCompleted">ÏûÖÏ∞® ÏôÑÎ£å</label>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary btn-full" id="submitBtn">
                            Îì±Î°ùÌïòÍ∏∞
                        </button>
                    </form>
                </div>
            </div>

            <!-- Îì±Î°ù ÌòÑÌô© ÌÉ≠ -->
            <div id="list" class="tab-content">
                <div class="card">
                    <h2 style="color: #ED1C24; margin-bottom: 20px;">üìã Îì±Î°ù ÌòÑÌô©</h2>

                    <div class="search-box">
                        <input type="text" id="searchInput" placeholder="üîç Í≤ÄÏÉâ (Ï∞®ÎüâÎ≤àÌò∏, Í±∞ÎûòÏ≤òÎ™Ö, Ï£ºÎ¨∏Î≤àÌò∏, Ïö¥Ï†ÑÏûêÎ™Ö)">
                    </div>

                    <div class="filter-tabs">
                        <button class="filter-btn active" onclick="filterVehicles('all')">Ï†ÑÏ≤¥</button>
                        <button class="filter-btn" onclick="filterVehicles('today')">Ïò§Îäò</button>
                        <button class="filter-btn" onclick="filterVehicles('pending')">ÏûÖÏ∞® ÎåÄÍ∏∞</button>
                        <button class="filter-btn" onclick="filterVehicles('completed')">ÏûÖÏ∞® ÏôÑÎ£å</button>
                    </div>

                    <div class="export-section">
                        <button class="export-btn" onclick="exportToCSV()">
                            <span>üìä</span>
                            <span id="exportBtnText">CSV ÎÇ¥Î≥¥ÎÇ¥Í∏∞</span>
                        </button>
                    </div>

                    <div class="vehicle-list" id="vehicleList">
                        <!-- Ï∞®Îüâ Î™©Î°ùÏù¥ Ïó¨Í∏∞Ïóê ÌëúÏãúÎê©ÎãàÎã§ -->
                    </div>
                </div>
            </div>

            <!-- ÏÑ§Ï†ï ÌÉ≠ -->
            <div id="settings" class="tab-content">
                <div class="card">
                    <h2 style="color: #ED1C24; margin-bottom: 20px;">‚öôÔ∏è ÏÑ§Ï†ï</h2>

                    <div class="form-group">
                        <label>Google Sheets URL</label>
                        <input type="text" id="googleSheetUrl" placeholder="Google Apps Script URL ÏûÖÎ†•">
                    </div>

                    <h3 style="margin-top: 30px; color: #ED1C24; font-size: 1.1rem;">üë• ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨</h3>
                    <div id="userManagement"></div>

                    <button class="btn btn-primary btn-full" onclick="saveSettings()" style="margin-top: 20px;">
                        üíæ ÏÑ§Ï†ï Ï†ÄÏû•
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ï≤òÎ¶¨ Ï§ë Ïò§Î≤ÑÎ†àÏù¥ -->
    <div class="processing-overlay" id="processingOverlay">
        <div class="spinner"></div>
        <div class="processing-text">Ïù¥ÎØ∏ÏßÄ Î∂ÑÏÑù Ï§ë...</div>
    </div>

    <!-- Tesseract.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

    <script>
        // Î≤àÏó≠ Í∞ùÏ≤¥
        const TRANSLATIONS = {
            ru: {
                // Ìó§Îçî
                title: 'üöõ –°–∏—Å—Ç–µ–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤—ä–µ–∑–¥–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞',
                subtitle: '–°–∏—Å—Ç–µ–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤—ä–µ–∑–¥–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ | Vehicle Entry Registration System',

                // ÌÉ≠
                tabRegister: '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è',
                tabList: '–°—Ç–∞—Ç—É—Å',
                tabSettings: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏',

                // Ï∞®Îüâ Îì±Î°ù Ìèº
                registerTitle: 'üöõ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞',
                userName: '–ò–º—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ *',
                selectPlaceholder: '–í—ã–±–µ—Ä–∏—Ç–µ',
                entryDate: '–î–∞—Ç–∞ –≤—ä–µ–∑–¥–∞ *',
                clientName: '–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞ *',
                clientPlaceholder: '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞',
                orderNumber: '–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞',
                orderPlaceholder: '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞',
                headNumber: '–ù–æ–º–µ—Ä –≥–æ–ª–æ–≤—ã *',
                headPlaceholder: '–ù–æ–º–µ—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≥–æ–ª–æ–≤—ã',
                trailerNumber: '–ù–æ–º–µ—Ä –ø—Ä–∏—Ü–µ–ø–∞ *',
                trailerPlaceholder: '–ù–æ–º–µ—Ä –ø—Ä–∏—Ü–µ–ø–∞',
                driverName: '–ò–º—è –≤–æ–¥–∏—Ç–µ–ª—è *',
                driverNamePlaceholder: '–ò–º—è –≤–æ–¥–∏—Ç–µ–ª—è',
                driverPassport: '–ù–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞ *',
                passportPlaceholder: '–ù–æ–º–µ—Ä –ø–∞—Å–ø–æ—Ä—Ç–∞',
                driverPhone: '–¢–µ–ª–µ—Ñ–æ–Ω –≤–æ–¥–∏—Ç–µ–ª—è',
                phonePlaceholder: '+7 XXX XXX XX XX',
                entryTime: '–í—Ä–µ–º—è –≤—ä–µ–∑–¥–∞',
                entryCompleted: '–í—ä–µ–∑–¥ –∑–∞–≤–µ—Ä—à—ë–Ω',
                submitBtn: '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å',
                successMessage: '‚úÖ –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω!',

                // Îì±Î°ù ÌòÑÌô©
                listTitle: 'üìã –°—Ç–∞—Ç—É—Å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏',
                searchPlaceholder: 'üîç –ü–æ–∏—Å–∫ (–Ω–æ–º–µ—Ä –∞–≤—Ç–æ, –∫–ª–∏–µ–Ω—Ç, –∑–∞–∫–∞–∑, –≤–æ–¥–∏—Ç–µ–ª—å)',
                filterAll: '–í—Å–µ',
                filterToday: '–°–µ–≥–æ–¥–Ω—è',
                filterPending: '–û–∂–∏–¥–∞–Ω–∏–µ',
                filterCompleted: '–ó–∞–≤–µ—Ä—à–µ–Ω–æ',
                exportBtn: '–≠–∫—Å–ø–æ—Ä—Ç –≤ CSV',
                noVehicles: '–ù–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–≤',
                statusCompleted: '–ó–∞–≤–µ—Ä—à–µ–Ω–æ',
                statusPending: '–û–∂–∏–¥–∞–Ω–∏–µ',
                btnToggleComplete: '–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ –æ–∂–∏–¥–∞–Ω–∏–µ',
                btnTogglePending: '–ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–æ',
                btnEdit: '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å',
                btnDelete: '–£–¥–∞–ª–∏—Ç—å',
                registeredBy: '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è',

                // ÏÑ§Ï†ï
                settingsTitle: '‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏',
                googleSheetUrl: 'Google Sheets URL',
                googleSheetPlaceholder: '–í–≤–µ–¥–∏—Ç–µ URL Google Apps Script',
                userManagement: 'üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏',
                btnSave: 'üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏',

                // Î©îÏãúÏßÄ
                passwordPrompt: '–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:',
                passwordWrong: '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å',
                deleteConfirm: '–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å?',
                deleteOwnOnly: '–í—ã –º–æ–∂–µ—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞–ø–∏—Å–∏',
                editOwnOnly: '–í—ã –º–æ–∂–µ—Ç–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –∑–∞–ø–∏—Å–∏',
                settingsSaved: '–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã',

                // AI Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú
                aiAutoFill: 'ü§ñ AI –ê–≤—Ç–æ–∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ',
                aiTabImage: 'üì∏ –ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è',
                aiTabText: 'üìù –í—Å—Ç–∞–≤–∏—Ç—å —Ç–µ–∫—Å—Ç',
                uploadImage: '–ó–∞–≥—Ä—É–∑–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏',
                uploadHint: '–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (PNG, JPG, PDF)',
                textPlaceholder: '–í—Å—Ç–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç –¥–æ–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –∏–∑ email...\n\n–ü—Ä–∏–º–µ—Ä:\n–ì–∞–≤—Ä–∏—Å –î–µ–Ω–∏—Å –í–∏–∫—Ç–æ—Ä–æ–≤–∏—á\n–ü–∞—Å–ø–æ—Ä—Ç MC3544098\nAX3623-5 / A39101-5\n–õ–û–¢–¢–ï',
                btnExtract: '–ò–∑–≤–ª–µ—á—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é',
                clearImage: '–£–¥–∞–ª–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ',
                processing: '–ê–Ω–∞–ª–∏–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...',
                extractSuccess: '‚úÖ –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–æ –∏–∑–≤–ª–µ—á–µ–Ω–∞!',
                extractError: '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∞–Ω–∞–ª–∏–∑–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è',

                // Î°úÍ∑∏Ïù∏
                loginTitle: 'üöõ –°–∏—Å—Ç–µ–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤—ä–µ–∑–¥–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞',
                loginSubtitle: 'Lotte KF –†–æ—Å—Å–∏–π—Å–∫–∏–π —Ñ–∏–ª–∏–∞–ª',
                username: '–õ–æ–≥–∏–Ω',
                password: '–ü–∞—Ä–æ–ª—å',
                rememberMe: '–ó–∞–ø–æ–º–Ω–∏—Ç—å –º–µ–Ω—è',
                loginBtn: '–í–æ–π—Ç–∏',
                loginError: '–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å',
                logout: 'üö™ –í—ã–π—Ç–∏',
                loggedInAs: '–í–æ—à–ª–∏ –∫–∞–∫'
            },
            ko: {
                // Ìó§Îçî
                title: 'üöõ Ï∞®Îüâ ÏûÖÏ∞® Îì±Î°ù ÏãúÏä§ÌÖú',
                subtitle: '–°–∏—Å—Ç–µ–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ –≤—ä–µ–∑–¥–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ | Vehicle Entry Registration System',

                // ÌÉ≠
                tabRegister: 'Ï∞®Îüâ Îì±Î°ù',
                tabList: 'Îì±Î°ù ÌòÑÌô©',
                tabSettings: 'ÏÑ§Ï†ï',

                // Ï∞®Îüâ Îì±Î°ù Ìèº
                registerTitle: 'üöõ Ï∞®Îüâ Ï†ïÎ≥¥ Îì±Î°ù',
                userName: 'ÏûÖÎ†•Ïûê Ïù¥Î¶Ñ *',
                selectPlaceholder: 'ÏÑ†ÌÉùÌïòÏÑ∏Ïöî',
                entryDate: 'ÏûÖÏ∞® ÎÇ†Ïßú *',
                clientName: 'Í±∞ÎûòÏ≤òÎ™Ö *',
                clientPlaceholder: 'Í±∞ÎûòÏ≤òÎ™Ö ÏûÖÎ†•',
                orderNumber: 'Ï£ºÎ¨∏Î≤àÌò∏',
                orderPlaceholder: 'Ï£ºÎ¨∏Î≤àÌò∏ ÏûÖÎ†•',
                headNumber: 'Ìó§Îìú Î≤àÌò∏ *',
                headPlaceholder: 'Ïª®ÌÖåÏù¥ÎÑà Ìó§Îìú Î≤àÌò∏',
                trailerNumber: 'Ìä∏Î†àÏùºÎü¨ Î≤àÌò∏ *',
                trailerPlaceholder: 'Ìä∏Î†àÏùºÎü¨ Î≤àÌò∏',
                driverName: 'Ïö¥Ï†ÑÏûê Ïù¥Î¶Ñ *',
                driverNamePlaceholder: 'Ïö¥Ï†ÑÏûê Ïù¥Î¶Ñ',
                driverPassport: 'Ïö¥Ï†ÑÏûê Ïó¨Í∂åÎ≤àÌò∏ *',
                passportPlaceholder: 'Ïó¨Í∂åÎ≤àÌò∏',
                driverPhone: 'Ïö¥Ï†ÑÏûê Ï†ÑÌôîÎ≤àÌò∏',
                phonePlaceholder: '+7 XXX XXX XX XX',
                entryTime: 'ÏûÖÏ∞® ÏòàÏ†ï ÏãúÍ∞Å',
                entryCompleted: 'ÏûÖÏ∞® ÏôÑÎ£å',
                submitBtn: 'Îì±Î°ùÌïòÍ∏∞',
                successMessage: '‚úÖ Ï∞®Îüâ Ï†ïÎ≥¥Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Îì±Î°ùÎêòÏóàÏäµÎãàÎã§!',

                // Îì±Î°ù ÌòÑÌô©
                listTitle: 'üìã Îì±Î°ù ÌòÑÌô©',
                searchPlaceholder: 'üîç Í≤ÄÏÉâ (Ï∞®ÎüâÎ≤àÌò∏, Í±∞ÎûòÏ≤òÎ™Ö, Ï£ºÎ¨∏Î≤àÌò∏, Ïö¥Ï†ÑÏûêÎ™Ö)',
                filterAll: 'Ï†ÑÏ≤¥',
                filterToday: 'Ïò§Îäò',
                filterPending: 'ÏûÖÏ∞® ÎåÄÍ∏∞',
                filterCompleted: 'ÏûÖÏ∞® ÏôÑÎ£å',
                exportBtn: 'CSV ÎÇ¥Î≥¥ÎÇ¥Í∏∞',
                noVehicles: 'Îì±Î°ùÎêú Ï∞®ÎüâÏù¥ ÏóÜÏäµÎãàÎã§',
                statusCompleted: 'ÏûÖÏ∞®ÏôÑÎ£å',
                statusPending: 'ÏûÖÏ∞®ÎåÄÍ∏∞',
                btnToggleComplete: 'ÎåÄÍ∏∞Î°ú Î≥ÄÍ≤Ω',
                btnTogglePending: 'ÏôÑÎ£åÎ°ú Î≥ÄÍ≤Ω',
                btnEdit: 'ÏàòÏ†ï',
                btnDelete: 'ÏÇ≠Ï†ú',
                registeredBy: 'Îì±Î°ù',

                // ÏÑ§Ï†ï
                settingsTitle: '‚öôÔ∏è ÏÑ§Ï†ï',
                googleSheetUrl: 'Google Sheets URL',
                googleSheetPlaceholder: 'Google Apps Script URL ÏûÖÎ†•',
                userManagement: 'üë• ÏÇ¨Ïö©Ïûê Í¥ÄÎ¶¨',
                btnSave: 'üíæ ÏÑ§Ï†ï Ï†ÄÏû•',

                // Î©îÏãúÏßÄ
                passwordPrompt: 'Í¥ÄÎ¶¨Ïûê ÎπÑÎ∞ÄÎ≤àÌò∏Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî:',
                passwordWrong: 'ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä ÌãÄÎ†∏ÏäµÎãàÎã§',
                deleteConfirm: 'Ï†ïÎßê ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?',
                deleteOwnOnly: 'Î≥∏Ïù∏Ïù¥ Îì±Î°ùÌïú Ï∞®ÎüâÎßå ÏÇ≠Ï†úÌï† Ïàò ÏûàÏäµÎãàÎã§',
                editOwnOnly: 'Î≥∏Ïù∏Ïù¥ Îì±Î°ùÌïú Ï∞®ÎüâÎßå ÏàòÏ†ïÌï† Ïàò ÏûàÏäµÎãàÎã§',
                settingsSaved: 'ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§',

                // AI Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú
                aiAutoFill: 'ü§ñ AI ÏûêÎèô ÏûÖÎ†•',
                aiTabImage: 'üì∏ Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú',
                aiTabText: 'üìù ÌÖçÏä§Ìä∏ Î∂ôÏó¨ÎÑ£Í∏∞',
                uploadImage: 'ÏúÑÏûÑÏû• Ïù¥ÎØ∏ÏßÄÎ•º ÏóÖÎ°úÎìúÌïòÏÑ∏Ïöî',
                uploadHint: 'ÌÅ¥Î¶≠ÌïòÍ±∞ÎÇò Ïù¥ÎØ∏ÏßÄÎ•º ÎìúÎûòÍ∑∏ÌïòÏÑ∏Ïöî (PNG, JPG, PDF)',
                textPlaceholder: 'Ïù¥Î©îÏùºÏóêÏÑú Î∞õÏùÄ ÏúÑÏûÑÏû• ÌÖçÏä§Ìä∏Î•º Ïó¨Í∏∞Ïóê Î∂ôÏó¨ÎÑ£ÏúºÏÑ∏Ïöî...\n\nÏòàÏãú:\n–ì–∞–≤—Ä–∏—Å –î–µ–Ω–∏—Å –í–∏–∫—Ç–æ—Ä–æ–≤–∏—á\n–ü–∞—Å–ø–æ—Ä—Ç MC3544098\nAX3623-5 / A39101-5\n–õ–û–¢–¢–ï',
                btnExtract: 'Ï†ïÎ≥¥ Ï∂îÏ∂úÌïòÍ∏∞',
                clearImage: 'Ïù¥ÎØ∏ÏßÄ Ï†úÍ±∞',
                processing: 'Ïù¥ÎØ∏ÏßÄ Î∂ÑÏÑù Ï§ë...',
                extractSuccess: '‚úÖ Ï†ïÎ≥¥Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï∂îÏ∂úÎêòÏóàÏäµÎãàÎã§!',
                extractError: '‚ùå Ïù¥ÎØ∏ÏßÄ Î∂ÑÏÑù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§',

                // Î°úÍ∑∏Ïù∏
                loginTitle: 'üöõ Ï∞®Îüâ ÏûÖÏ∞® Îì±Î°ù ÏãúÏä§ÌÖú',
                loginSubtitle: 'Lotte KF Îü¨ÏãúÏïÑÎ≤ïÏù∏',
                username: 'ÏïÑÏù¥Îîî',
                password: 'ÎπÑÎ∞ÄÎ≤àÌò∏',
                rememberMe: 'Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú Ïú†ÏßÄ',
                loginBtn: 'Î°úÍ∑∏Ïù∏',
                loginError: 'ÏïÑÏù¥Îîî ÎòêÎäî ÎπÑÎ∞ÄÎ≤àÌò∏Í∞Ä Ïò¨Î∞îÎ•¥ÏßÄ ÏïäÏäµÎãàÎã§',
                logout: 'üö™ Î°úÍ∑∏ÏïÑÏõÉ',
                loggedInAs: 'Î°úÍ∑∏Ïù∏:'
            }
        };

        let currentLang = 'ru'; // Í∏∞Î≥∏ Ïñ∏Ïñ¥: Îü¨ÏãúÏïÑÏñ¥
        let dateTimeInterval = null; // ÎÇ†Ïßú/ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏ Ïù∏ÌÑ∞Î≤å

        const STORAGE_KEYS = {
            vehicles: 'vehicleRegistrations',
            settings: 'vehicleSettings',
            users: 'vehicleUsers',
            language: 'preferredLanguage',
            learningData: 'ocrLearningData',
            lastOcrExtraction: 'lastOcrExtraction',
            accounts: 'userAccounts',
            currentUser: 'currentUser',
            rememberMe: 'rememberMe'
        };

        // Í∏∞Î≥∏ ÏÇ¨Ïö©Ïûê Î™©Î°ù
        const DEFAULT_USERS = [
            { name: 'Ï°∞ÏÑ±ÎØº', role: 'ÏòÅÏóÖÌåÄ', isActive: true },
            { name: 'ÍπÄÏòÅÏóÖ', role: 'ÏòÅÏóÖÌåÄ', isActive: true },
            { name: 'Ïù¥Î¨ºÎ•ò', role: 'Î¨ºÎ•òÌåÄ', isActive: true },
            { name: 'Î∞ïÏ∞ΩÍ≥†', role: 'Ï∞ΩÍ≥†', isActive: true },
            { name: 'ÏµúÍ≤ΩÎπÑ', role: 'Í≤ΩÎπÑ', isActive: true }
        ];

        // ========== Í≥ÑÏ†ï Í¥ÄÎ¶¨ Î∞è Ïù∏Ï¶ù ==========

        // Í∞ÑÎã®Ìïú ÎπÑÎ∞ÄÎ≤àÌò∏ Ìï¥Ïã± (Base64 Ïù∏ÏΩîÎî© + Salt)
        function hashPassword(password) {
            const salt = 'LotteKF2025';
            return btoa(salt + password + salt);
        }

        // Í≥ÑÏ†ï Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞
        function loadAccounts() {
            const accounts = localStorage.getItem(STORAGE_KEYS.accounts);
            if (accounts) {
                return JSON.parse(accounts);
            }

            // Í∏∞Î≥∏ Í¥ÄÎ¶¨Ïûê Í≥ÑÏ†ï Î∞è ÏßÅÏõê Í≥ÑÏ†ï ÏÉùÏÑ±
            const defaultAccounts = [
                {
                    username: 'admin',
                    password: hashPassword('1234'),
                    name: 'Í¥ÄÎ¶¨Ïûê',
                    role: 'Í¥ÄÎ¶¨Ïûê',
                    isAdmin: true
                },
                {
                    username: 'cho',
                    password: hashPassword('1234'),
                    name: 'Ï°∞ÏÑ±ÎØº',
                    role: 'ÏòÅÏóÖÌåÄ',
                    isAdmin: false
                }
            ];

            saveAccounts(defaultAccounts);
            return defaultAccounts;
        }

        // Í≥ÑÏ†ï Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
        function saveAccounts(accounts) {
            localStorage.setItem(STORAGE_KEYS.accounts, JSON.stringify(accounts));
        }

        // Î°úÍ∑∏Ïù∏ Ï≤òÎ¶¨
        function handleLogin(event) {
            event.preventDefault();

            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const rememberMe = document.getElementById('rememberMe').checked;

            const accounts = loadAccounts();
            const hashedPassword = hashPassword(password);

            const account = accounts.find(acc =>
                acc.username === username && acc.password === hashedPassword
            );

            if (account) {
                // Î°úÍ∑∏Ïù∏ ÏÑ±Í≥µ
                const currentUser = {
                    username: account.username,
                    name: account.name,
                    role: account.role,
                    isAdmin: account.isAdmin || false
                };

                localStorage.setItem(STORAGE_KEYS.currentUser, JSON.stringify(currentUser));

                if (rememberMe) {
                    localStorage.setItem(STORAGE_KEYS.rememberMe, 'true');
                } else {
                    localStorage.removeItem(STORAGE_KEYS.rememberMe);
                }

                // ÏÇ¨Ïö©Ïûê ÏÑ†ÌÉù Î™©Î°ùÏóê ÏûêÎèô ÏÑ†ÌÉù
                localStorage.setItem('lastSelectedUser', account.name);

                showMainApp();
            } else {
                // Î°úÍ∑∏Ïù∏ Ïã§Ìå®
                const loginError = document.getElementById('loginError');
                loginError.classList.add('show');
                setTimeout(() => loginError.classList.remove('show'), 3000);
            }
        }

        // Î°úÍ∑∏ÏïÑÏõÉ Ï≤òÎ¶¨
        function logout() {
            const t = TRANSLATIONS[currentLang];

            if (confirm('Ï†ïÎßê Î°úÍ∑∏ÏïÑÏõÉÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                localStorage.removeItem(STORAGE_KEYS.currentUser);

                const rememberMe = localStorage.getItem(STORAGE_KEYS.rememberMe);
                if (!rememberMe) {
                    localStorage.removeItem('lastSelectedUser');
                }

                showLoginPage();
            }
        }

        // Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄ ÌëúÏãú
        function showLoginPage() {
            document.getElementById('loginPage').style.display = 'flex';
            const currentUser = localStorage.getItem(STORAGE_KEYS.currentUser);

            if (currentUser) {
                showMainApp();
            } else {
                showLoginPage();
            }
        }

        // ÏÑ§Ï†ï Î∂àÎü¨Ïò§Í∏∞
        function loadSettings() {
            const settings = localStorage.getItem(STORAGE_KEYS.settings);
            if (settings) {
                return JSON.parse(settings);
            }
            return {
                googleSheetUrl: '',
                users: DEFAULT_USERS
            };
        }

        // ÏÑ§Ï†ï Ï†ÄÏû•
        function saveSettings() {
            const settings = {
                googleSheetUrl: document.getElementById('googleSheetUrl').value,
                users: loadSettings().users
            };
            localStorage.setItem(STORAGE_KEYS.settings, JSON.stringify(settings));
            alert(TRANSLATIONS[currentLang].settingsSaved);
        }

        // Ï∞®Îüâ Îì±Î°ù Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞
        function loadVehicles() {
            const vehicles = localStorage.getItem(STORAGE_KEYS.vehicles);
            return vehicles ? JSON.parse(vehicles) : [];
        }

        // Ï∞®Îüâ Îì±Î°ù Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
        function saveVehicles(vehicles) {
            localStorage.setItem(STORAGE_KEYS.vehicles, JSON.stringify(vehicles));
        }

        // OCR ÌïôÏäµ Îç∞Ïù¥ÌÑ∞ Î∂àÎü¨Ïò§Í∏∞
        function loadLearningData() {
            const data = localStorage.getItem(STORAGE_KEYS.learningData);
            return data ? JSON.parse(data) : {
                clientMappings: {},    // ÌÖçÏä§Ìä∏ Ìå®ÌÑ¥ -> Í±∞ÎûòÏ≤òÎ™Ö
                orderMappings: {},     // ÌÖçÏä§Ìä∏ Ìå®ÌÑ¥ -> Ï£ºÎ¨∏Î≤àÌò∏
                nameMappings: {},      // ÌÖçÏä§Ìä∏ Ìå®ÌÑ¥ -> Ïö¥Ï†ÑÏûêÎ™Ö
                passportMappings: {},  // ÌÖçÏä§Ìä∏ Ìå®ÌÑ¥ -> Ïó¨Í∂åÎ≤àÌò∏
                totalExtractions: 0,   // Ï¥ù Ï∂îÏ∂ú ÌöüÏàò
                corrections: 0         // Ï¥ù ÏàòÏ†ï ÌöüÏàò
            };
        }

        // OCR ÌïôÏäµ Îç∞Ïù¥ÌÑ∞ Ï†ÄÏû•
        function saveLearningData(data) {
            localStorage.setItem(STORAGE_KEYS.learningData, JSON.stringify(data));
        }

        // ÌïôÏäµ Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏ (Ìèº Ï†úÏ∂ú Ïãú Ìò∏Ï∂ú)
        function updateLearningData(originalText, extractedData, finalData) {
            const learningData = loadLearningData();
            learningData.totalExtractions++;

            // Í±∞ÎûòÏ≤òÎ™Ö ÌïôÏäµ
            if (extractedData.clientName !== finalData.clientName && finalData.clientName) {
                learningData.corrections++;
                // ÏõêÎ≥∏ ÌÖçÏä§Ìä∏ÏóêÏÑú ÌÇ§ÏõåÎìú Ï∂îÏ∂ú
                const keywords = extractClientKeywords(originalText);
                keywords.forEach(keyword => {
                    learningData.clientMappings[keyword] = finalData.clientName;
                });
            }

            // Ï£ºÎ¨∏Î≤àÌò∏ ÌïôÏäµ
            if (extractedData.orderNumber !== finalData.orderNumber && finalData.orderNumber) {
                learningData.corrections++;
                const orderPattern = extractOrderPattern(originalText, finalData.orderNumber);
                if (orderPattern) {
                    learningData.orderMappings[orderPattern] = finalData.orderNumber;
                }
            }

            // Ïö¥Ï†ÑÏûêÎ™Ö ÌïôÏäµ
            if (extractedData.driverName !== finalData.driverName && finalData.driverName) {
                learningData.corrections++;
                learningData.nameMappings[extractedData.driverName] = finalData.driverName;
            }

            // Ïó¨Í∂åÎ≤àÌò∏ ÌïôÏäµ
            if (extractedData.driverPassport !== finalData.driverPassport && finalData.driverPassport) {
                learningData.corrections++;
                learningData.passportMappings[extractedData.driverPassport] = finalData.driverPassport;
            }

            saveLearningData(learningData);
            console.log('ÌïôÏäµ Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏:', learningData);
        }

        // Í±∞ÎûòÏ≤òÎ™Ö ÌÇ§ÏõåÎìú Ï∂îÏ∂ú
        function extractClientKeywords(text) {
            const keywords = [];
            // ÎåÄÎ¨∏Ïûê Îã®Ïñ¥ Ï∂îÏ∂ú
            const upperWords = text.match(/[A-Z–ê-–Ø–Å]{3,}/g);
            if (upperWords) {
                keywords.push(...upperWords);
            }
            return keywords;
        }

        // Ï£ºÎ¨∏Î≤àÌò∏ Ìå®ÌÑ¥ Ï∂îÏ∂ú
        function extractOrderPattern(text, orderNumber) {
            // Ï£ºÎ¨∏Î≤àÌò∏ Ï£ºÎ≥Ä ÌÖçÏä§Ìä∏ Ìå®ÌÑ¥ Ï∂îÏ∂ú
            const index = text.indexOf(orderNumber);
            if (index > -1) {
                return text.substring(Math.max(0, index - 20), index + orderNumber.length + 20).trim();
            }
            return null;
        }

        // ÏÇ¨Ïö©Ïûê Î™©Î°ù Î†åÎçîÎßÅ
        function renderUserSelect() {
            const settings = loadSettings();
            const select = document.getElementById('userName');
            select.innerHTML = '<option value="">ÏÑ†ÌÉùÌïòÏÑ∏Ïöî</option>';

            settings.users.filter(u => u.isActive).forEach(user => {
                const option = document.createElement('option');
                option.value = user.name;
                option.textContent = `${user.name} (${user.role})`;
                select.appendChild(option);
            });

            // ÎßàÏßÄÎßâ ÏÑ†ÌÉù ÏÇ¨Ïö©Ïûê Î≥µÏõê
            const lastUser = localStorage.getItem('lastSelectedUser');
            if (lastUser) {
                select.value = lastUser;
            }
        }

        // Ï∞®Îüâ Îì±Î°ù Ìèº Ï†úÏ∂ú
        document.getElementById('vehicleForm').addEventListener('submit', function (e) {
            e.preventDefault();

            const userName = document.getElementById('userName').value;
            const finalData = {
                clientName: document.getElementById('clientName').value,
                orderNumber: document.getElementById('orderNumber').value,
                headNumber: document.getElementById('headNumber').value,
                trailerNumber: document.getElementById('trailerNumber').value,
                driverName: document.getElementById('driverName').value,
                driverPassport: document.getElementById('driverPassport').value,
                driverPhone: document.getElementById('driverPhone').value,
                entryTime: document.getElementById('entryTime').value
            };

            const vehicle = {
                id: Date.now(),
                registeredBy: userName,
                registeredAt: new Date().toISOString(),
                entryDate: document.getElementById('entryDate').value,
                ...finalData,
                entryCompleted: document.getElementById('entryCompleted').checked
            };

            // OCR ÌïôÏäµ Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
            const lastExtraction = localStorage.getItem(STORAGE_KEYS.lastOcrExtraction);
            if (lastExtraction) {
                const { originalText, extractedData } = JSON.parse(lastExtraction);
                updateLearningData(originalText, extractedData, finalData);
                // ÌïôÏäµ ÌõÑ ÏÇ≠Ï†ú
                localStorage.removeItem(STORAGE_KEYS.lastOcrExtraction);
            }

            const vehicles = loadVehicles();
            vehicles.push(vehicle);
            saveVehicles(vehicles);

            // ÏÑ±Í≥µ Î©îÏãúÏßÄ ÌëúÏãú
            const successMsg = document.getElementById('successMessage');
            successMsg.classList.add('show');
            setTimeout(() => successMsg.classList.remove('show'), 3000);

            // Ìèº Ï¥àÍ∏∞Ìôî
            document.getElementById('vehicleForm').reset();
            document.getElementById('userName').value = userName;
            localStorage.setItem('lastSelectedUser', userName);

            // Google Sheets ÎèôÍ∏∞Ìôî (ÏûàÎäî Í≤ΩÏö∞)
            syncToGoogleSheet(vehicle);
        });

        // Ï∞®Îüâ Î™©Î°ù Î†åÎçîÎßÅ
        function renderVehicleList(filter = 'all') {
            const vehicles = loadVehicles();
            const container = document.getElementById('vehicleList');
            const searchQuery = document.getElementById('searchInput').value.toLowerCase();

            let filteredVehicles = vehicles;

            // ÌïÑÌÑ∞ Ï†ÅÏö©
            if (filter === 'today') {
                const today = new Date().toISOString().split('T')[0];
                filteredVehicles = vehicles.filter(v => v.entryDate === today);
            } else if (filter === 'pending') {
                filteredVehicles = vehicles.filter(v => !v.entryCompleted);
            } else if (filter === 'completed') {
                filteredVehicles = vehicles.filter(v => v.entryCompleted);
            }

            // Í≤ÄÏÉâÏñ¥ Ï†ÅÏö©
            if (searchQuery) {
                filteredVehicles = filteredVehicles.filter(v =>
                    v.headNumber.toLowerCase().includes(searchQuery) ||
                    v.trailerNumber.toLowerCase().includes(searchQuery) ||
                    v.clientName.toLowerCase().includes(searchQuery) ||
                    v.orderNumber.toLowerCase().includes(searchQuery) ||
                    v.driverName.toLowerCase().includes(searchQuery)
                );
            }

            // ÎÇ†ÏßúÏôÄ ÏãúÍ∞ÑÎ≥ÑÎ°ú Ï†ïÎ†¨ (ÏûÖÏ∞®ÎÇ†Ïßú + ÏûÖÏ∞®ÏòàÏ†ïÏãúÍ∞Å)
            // ÏûÖÏ∞® ÏòàÏ†ï ÏãúÍ∞ÅÏù¥ ÏóÜÏúºÎ©¥ 20:00ÏúºÎ°ú Í∞ÑÏ£º
            filteredVehicles.sort((a, b) => {
                const timeA = a.entryTime || '20:00';
                const timeB = b.entryTime || '20:00';
                const dateTimeA = new Date(`${a.entryDate}T${timeA}`);
                const dateTimeB = new Date(`${b.entryDate}T${timeB}`);
                return dateTimeA - dateTimeB;
            });

            const t = TRANSLATIONS[currentLang];

            if (filteredVehicles.length === 0) {
                container.innerHTML = `<p style="text-align: center; color: #999; padding: 40px;">${t.noVehicles}</p>`;
                return;
            }

            container.innerHTML = filteredVehicles.map(vehicle => `
                <div class="vehicle-item ${vehicle.entryCompleted ? 'completed' : 'pending'}">
                    <div class="vehicle-header">
                        <div class="vehicle-info">
                            <div class="vehicle-number">
                                üöõ ${vehicle.headNumber} / ${vehicle.trailerNumber}
                            </div>
                            <div class="vehicle-details">
                                üìÖ ${vehicle.entryDate} ${vehicle.entryTime} |
                                üè¢ ${vehicle.clientName} |
                                üì¶ ${vehicle.orderNumber}<br>
                                üë§ ${vehicle.driverName} |
                                üì± ${vehicle.driverPhone} |
                                üõÇ ${vehicle.driverPassport}<br>
                                <span style="color: #999; font-size: 0.85rem;">${t.registeredBy}: ${vehicle.registeredBy} (${new Date(vehicle.registeredAt).toLocaleString('ko-KR')})</span>
                            </div>
                        </div>
                        <span class="status-badge ${vehicle.entryCompleted ? 'status-completed' : 'status-pending'}">
                            ${vehicle.entryCompleted ? t.statusCompleted : t.statusPending}
                        </span>
                    </div>
                    <div class="vehicle-actions">
                        <button class="btn btn-small btn-success" onclick="toggleEntryStatus(${vehicle.id})">
                            ${vehicle.entryCompleted ? t.btnToggleComplete : t.btnTogglePending}
                        </button>
                        <button class="btn btn-small btn-secondary" onclick="editVehicle(${vehicle.id})">${t.btnEdit}</button>
                        <button class="btn btn-small btn-danger" onclick="deleteVehicle(${vehicle.id}, '${vehicle.registeredBy}')">${t.btnDelete}</button>
                    </div>
                </div>
            `).join('');
        }

        // ÏûÖÏ∞® ÏÉÅÌÉú ÌÜ†Í∏Ä
        function toggleEntryStatus(id) {
            const vehicles = loadVehicles();
            const vehicle = vehicles.find(v => v.id === id);
            if (vehicle) {
                vehicle.entryCompleted = !vehicle.entryCompleted;
                saveVehicles(vehicles);
                renderVehicleList();
            }
        }

        // Ï∞®Îüâ Ï†ïÎ≥¥ ÏÇ≠Ï†ú
        function deleteVehicle(id, registeredBy) {
            const userName = localStorage.getItem('lastSelectedUser');

            // Î≥∏Ïù∏Ïù¥ Îì±Î°ùÌïú Í≤ÉÎßå ÏÇ≠Ï†ú Í∞ÄÎä•
            if (userName !== registeredBy) {
                alert(TRANSLATIONS[currentLang].deleteOwnOnly);
                return;
            }

            if (confirm(TRANSLATIONS[currentLang].deleteConfirm)) {
                let vehicles = loadVehicles();
                vehicles = vehicles.filter(v => v.id !== id);
                saveVehicles(vehicles);
                renderVehicleList();
            }
        }

        // Ï∞®Îüâ Ï†ïÎ≥¥ ÏàòÏ†ï
        function editVehicle(id) {
            const vehicles = loadVehicles();
            const vehicle = vehicles.find(v => v.id === id);

            if (!vehicle) return;

            const userName = localStorage.getItem('lastSelectedUser');

            // Î≥∏Ïù∏Ïù¥ Îì±Î°ùÌïú Í≤ÉÎßå ÏàòÏ†ï Í∞ÄÎä•
            if (userName !== vehicle.registeredBy) {
                alert(TRANSLATIONS[currentLang].editOwnOnly);
                return;
            }

            // Îì±Î°ù ÌÉ≠ÏúºÎ°ú Ïù¥Îèô
            switchTab('register');

            // ÌèºÏóê Îç∞Ïù¥ÌÑ∞ Ï±ÑÏö∞Í∏∞
            document.getElementById('userName').value = vehicle.registeredBy;
            document.getElementById('entryDate').value = vehicle.entryDate;
            document.getElementById('clientName').value = vehicle.clientName;
            document.getElementById('orderNumber').value = vehicle.orderNumber;
            document.getElementById('headNumber').value = vehicle.headNumber;
            document.getElementById('trailerNumber').value = vehicle.trailerNumber;
            document.getElementById('driverName').value = vehicle.driverName;
            document.getElementById('driverPassport').value = vehicle.driverPassport;
            document.getElementById('driverPhone').value = vehicle.driverPhone;
            document.getElementById('entryTime').value = vehicle.entryTime;
            document.getElementById('entryCompleted').checked = vehicle.entryCompleted;

            // Í∏∞Ï°¥ Îç∞Ïù¥ÌÑ∞ ÏÇ≠Ï†ú (ÏàòÏ†ï ÌõÑ ÏÉàÎ°ú Îì±Î°ù)
            const updatedVehicles = vehicles.filter(v => v.id !== id);
            saveVehicles(updatedVehicles);
        }

        // ÌïÑÌÑ∞ Î≥ÄÍ≤Ω
        let currentFilter = 'all';
        function filterVehicles(filter) {
            currentFilter = filter;

            // Î≤ÑÌäº Ïä§ÌÉÄÏùº ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            renderVehicleList(filter);
        }

        // Í≤ÄÏÉâ
        document.getElementById('searchInput').addEventListener('input', function () {
            renderVehicleList(currentFilter);
        });

        // CSV ÎÇ¥Î≥¥ÎÇ¥Í∏∞
        function exportToCSV() {
            const vehicles = loadVehicles();

            if (vehicles.length === 0) {
                alert(currentLang === 'ko' ? 'ÎÇ¥Î≥¥ÎÇº Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.' : '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞.');
                return;
            }

            // CSV Ìó§Îçî (ÌïúÍµ≠Ïñ¥/Îü¨ÏãúÏïÑÏñ¥)
            const headers = currentLang === 'ko'
                ? ['Îì±Î°ùÏùºÏãú', 'Îì±Î°ùÏûê', 'ÏûÖÏ∞®ÎÇ†Ïßú', 'Í±∞ÎûòÏ≤òÎ™Ö', 'Ï£ºÎ¨∏Î≤àÌò∏', 'Ìó§ÎìúÎ≤àÌò∏', 'Ìä∏Î†àÏùºÎü¨Î≤àÌò∏', 'Ïö¥Ï†ÑÏûêÎ™Ö', 'Ïö¥Ï†ÑÏûêÏó¨Í∂å', 'Ïö¥Ï†ÑÏûêÏ†ÑÌôî', 'ÏûÖÏ∞®ÏòàÏ†ïÏãúÍ∞Å', 'ÏûÖÏ∞®ÏôÑÎ£åÏó¨Î∂Ä']
                : ['–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏', '–†–µ–≥–∏—Å—Ç—Ä–∞—Ç–æ—Ä', '–î–∞—Ç–∞ –≤—ä–µ–∑–¥–∞', '–ö–ª–∏–µ–Ω—Ç', '–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞', '–ù–æ–º–µ—Ä —Ç—è–≥–∞—á–∞', '–ù–æ–º–µ—Ä –ø—Ä–∏—Ü–µ–ø–∞', '–§–ò–û –≤–æ–¥–∏—Ç–µ–ª—è', '–ü–∞—Å–ø–æ—Ä—Ç', '–¢–µ–ª–µ—Ñ–æ–Ω', '–í—Ä–µ–º—è –≤—ä–µ–∑–¥–∞', '–°—Ç–∞—Ç—É—Å'];

            // CSV Îç∞Ïù¥ÌÑ∞ Ìñâ ÏÉùÏÑ±
            const rows = vehicles.map(v => {
                const registeredAt = new Date(v.registeredAt).toLocaleString('ko-KR');
                const completedText = currentLang === 'ko'
                    ? (v.entryCompleted ? 'ÏôÑÎ£å' : 'ÎåÄÍ∏∞')
                    : (v.entryCompleted ? '–ó–∞–≤–µ—Ä—à–µ–Ω–æ' : '–û–∂–∏–¥–∞–Ω–∏–µ');

                return [
                    registeredAt,
                    v.registeredBy || '',
                    v.entryDate || '',
                    v.clientName || '',
                    v.orderNumber || '',
                    v.headNumber || '',
                    v.trailerNumber || '',
                    v.driverName || '',
                    v.driverPassport || '',
                    v.driverPhone || '',
                    v.entryTime || '',
                    completedText
                ].map(field => `"${field}"`).join(',');
            });

            // CSV Î¨∏ÏûêÏó¥ ÏÉùÏÑ±
            const csvContent = [
                headers.map(h => `"${h}"`).join(','),
                ...rows
            ].join('\n');

            // BOM Ï∂îÍ∞Ä (ÏóëÏÖÄÏóêÏÑú ÌïúÍ∏Ä/Îü¨ÏãúÏïÑÏñ¥ Íπ®Ïßê Î∞©ÏßÄ)
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + csvContent], { type: 'text/csv;charset=utf-8;' });

            // ÌååÏùº Îã§Ïö¥Î°úÎìú
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            const today = new Date().toISOString().split('T')[0];

            link.setAttribute('href', url);
            link.setAttribute('download', `Lotte_Vehicle_Registration_${today}.csv`);
            link.style.visibility = 'hidden';

            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            // ÏÑ±Í≥µ Î©îÏãúÏßÄ
            const message = currentLang === 'ko'
                ? `${vehicles.length}Í∞úÏùò Ï∞®Îüâ Îç∞Ïù¥ÌÑ∞Î•º CSVÎ°ú ÎÇ¥Î≥¥ÎÉàÏäµÎãàÎã§.`
                : `–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–æ ${vehicles.length} –∑–∞–ø–∏—Å–µ–π –≤ CSV.`;
            alert(message);
        }

        // Google Sheets ÎèôÍ∏∞Ìôî
        async function syncToGoogleSheet(vehicle) {
            const settings = loadSettings();
            if (!settings.googleSheetUrl) return;

            try {
                await fetch(settings.googleSheetUrl, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        action: 'addVehicle',
                        data: vehicle
                    })
                });
            } catch (error) {
                console.error('Google Sheets ÎèôÍ∏∞Ìôî Ïã§Ìå®:', error);
            }
        }

        // ÌÉ≠ Ï†ÑÌôò
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');

            if (tabName === 'list') {
                renderVehicleList(currentFilter);
            } else if (tabName === 'settings') {
                const settings = loadSettings();
                document.getElementById('googleSheetUrl').value = settings.googleSheetUrl;
            }
        }

        // Ïñ∏Ïñ¥ Ï†ÑÌôò Ìï®Ïàò
        function switchLanguage(lang) {
            currentLang = lang;
            localStorage.setItem(STORAGE_KEYS.language, lang);

            // Î≤ÑÌäº active ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // UI ÏóÖÎç∞Ïù¥Ìä∏
            updateLanguage();
        }

        // ÏïàÏ†ÑÌïòÍ≤å ÏöîÏÜå ÏóÖÎç∞Ïù¥Ìä∏ÌïòÎäî Ìó¨Ìçº Ìï®Ïàò
        function safeSetText(selector, text, isId = false) {
            try {
                const element = isId ? document.getElementById(selector) : document.querySelector(selector);
                if (element) {
                    element.textContent = text;
                    return true;
                }
                return false;
            } catch (e) {
                return false;
            }
        }

        function safeSetPlaceholder(id, text) {
            try {
                const element = document.getElementById(id);
                if (element) {
                    element.placeholder = text;
                    return true;
                }
                return false;
            } catch (e) {
                return false;
            }
        }

        // Ïñ∏Ïñ¥Ïóê ÎßûÍ≤å UI ÏóÖÎç∞Ïù¥Ìä∏
        function updateLanguage() {
            try {
                const t = TRANSLATIONS[currentLang];

                // Î°úÍ∑∏Ïù∏ ÌéòÏù¥ÏßÄ
                document.getElementById('loginTitle').textContent = t.loginTitle;
                document.getElementById('loginSubtitle').textContent = t.loginSubtitle;
                document.getElementById('loginUsernameLabel').textContent = t.username;
                document.getElementById('loginPasswordLabel').textContent = t.password;
                document.getElementById('rememberMeLabel').textContent = t.rememberMe;
                document.getElementById('loginBtn').textContent = t.loginBtn;
                document.getElementById('loginError').textContent = t.loginError;

                // Ìó§Îçî
                safeSetText('.header h1', t.title);

                const subtitleEl = document.querySelector('.subtitle');
                if (subtitleEl) {
                    subtitleEl.innerHTML = t.subtitle + ' <span style="font-size: 0.75em; color: #fff; margin-left: 8px;">v0.1</span>';
                }

                // ÌÉ≠ Î≤ÑÌäº
                const tabBtns = document.querySelectorAll('.tab-btn');
                if (tabBtns.length >= 3) {
                    tabBtns[0].textContent = t.tabRegister;
                    tabBtns[1].textContent = t.tabList;
                    tabBtns[2].textContent = t.tabSettings;
                }

                // Ï∞®Îüâ Îì±Î°ù Ìèº
                safeSetText('#register h2', t.registerTitle);
                document.querySelector('label[for="userName"]').textContent = t.userName;
                document.querySelector('#userName option[value=""]').textContent = t.selectPlaceholder;
                document.querySelector('label[for="entryDate"]').textContent = t.entryDate;
                document.querySelector('label[for="clientName"]').textContent = t.clientName;
                document.getElementById('clientName').placeholder = t.clientPlaceholder;
                document.querySelector('label[for="orderNumber"]').textContent = t.orderNumber;
                document.getElementById('orderNumber').placeholder = t.orderPlaceholder;
                document.querySelector('label[for="headNumber"]').textContent = t.headNumber;
                document.getElementById('headNumber').placeholder = t.headPlaceholder;
                document.querySelector('label[for="trailerNumber"]').textContent = t.trailerNumber;
                document.getElementById('trailerNumber').placeholder = t.trailerPlaceholder;
                document.querySelector('label[for="driverName"]').textContent = t.driverName;
                document.getElementById('driverName').placeholder = t.driverNamePlaceholder;
                document.querySelector('label[for="driverPassport"]').textContent = t.driverPassport;
                document.getElementById('driverPassport').placeholder = t.passportPlaceholder;
                document.querySelector('label[for="driverPhone"]').textContent = t.driverPhone;
                document.getElementById('driverPhone').placeholder = t.phonePlaceholder;
                document.querySelector('label[for="entryTime"]').textContent = t.entryTime;
                document.querySelector('label[for="entryCompleted"]').textContent = t.entryCompleted;
                document.getElementById('submitBtn').textContent = t.submitBtn;
                document.getElementById('successMessage').textContent = t.successMessage;

                // Îì±Î°ù ÌòÑÌô©
                safeSetText('#list h2', t.listTitle);
                document.getElementById('searchInput').placeholder = t.searchPlaceholder;

                const filterBtns = document.querySelectorAll('.filter-btn');
                filterBtns[0].textContent = t.filterAll;
                filterBtns[1].textContent = t.filterToday;
                filterBtns[2].textContent = t.filterPending;
                filterBtns[3].textContent = t.filterCompleted;

                document.getElementById('exportBtnText').textContent = t.exportBtn;

                // ÏÑ§Ï†ï
                safeSetText('#settings h2', t.settingsTitle);
                safeSetText('label[for="googleSheetUrl"]', t.googleSheetUrl);
                safeSetPlaceholder('googleSheetUrl', t.googleSheetPlaceholder);
                safeSetText('#settings h3', t.userManagement);
                safeSetText('#settings .btn', t.btnSave);

                // AI ÏóÖÎ°úÎìú ÏÑπÏÖò
                safeSetText('.ai-upload-section h3', t.aiAutoFill);

                const aiTabBtns = document.querySelectorAll('.ai-tab-btn');
                if (aiTabBtns.length >= 2) {
                    aiTabBtns[0].textContent = t.aiTabImage;
                    aiTabBtns[1].textContent = t.aiTabText;
                }

                safeSetText('.upload-text', t.uploadImage);
                safeSetText('.upload-hint', t.uploadHint);
                safeSetPlaceholder('textInput', t.textPlaceholder);
                safeSetText('.btn-extract', t.btnExtract);
                safeSetText('#clearImageBtn', t.clearImage, true);
                safeSetText('.processing-text', t.processing);

                // Î°úÍ∑∏ÏïÑÏõÉ Î≤ÑÌäºÍ≥º ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥
                const logoutBtn = document.querySelector('.logout-btn');
                if (logoutBtn) {
                    logoutBtn.textContent = t.logout;
                }

                // ÏÇ¨Ïö©Ïûê Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
                const currentUser = localStorage.getItem(STORAGE_KEYS.currentUser);
                if (currentUser) {
                    const user = JSON.parse(currentUser);
                    document.getElementById('userInfo').textContent =
                        `${t.loggedInAs}: ${user.name} (${user.role})`;
                }

                // ÎÇ†Ïßú/ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏ (Ïñ∏Ïñ¥ Î≥ÄÍ≤Ω Î∞òÏòÅ)
                updateDateTime();

                // Î™©Î°ù ÏÉàÎ°úÍ≥†Ïπ®
                renderVehicleList(currentFilter);
            } catch (error) {
                console.error('updateLanguage error:', error);
                // Ïò§Î•òÍ∞Ä Î∞úÏÉùÌï¥ÎèÑ Í≥ÑÏÜç ÏßÑÌñâ (ÏùºÎ∂Ä ÏöîÏÜåÍ∞Ä ÏóÜÏùÑ Ïàò ÏûàÏùå)
            }
        }

        // ========== AI Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú Î∞è OCR Í∏∞Îä• ==========

        // AI ÏÑπÏÖò ÌÜ†Í∏Ä
        function toggleAISection() {
            const content = document.getElementById('aiSectionContent');
            const icon = document.querySelector('.ai-toggle-icon');

            content.classList.toggle('expanded');
            icon.classList.toggle('expanded');
        }

        // AI ÌÉ≠ Ï†ÑÌôò
        function switchAITab(tab) {
            const tabs = document.querySelectorAll('.ai-tab-content');
            const btns = document.querySelectorAll('.ai-tab-btn');

            tabs.forEach(t => t.classList.remove('active'));
            btns.forEach(b => b.classList.remove('active'));

            if (tab === 'image') {
                document.getElementById('imageTab').classList.add('active');
                btns[0].classList.add('active');
            } else {
                document.getElementById('textTab').classList.add('active');
                btns[1].classList.add('active');
            }
        }

        // ÌÖçÏä§Ìä∏ÏóêÏÑú Ï†ïÎ≥¥ Ï∂îÏ∂ú
        function extractFromText() {
            const text = document.getElementById('textInput').value;
            if (!text.trim()) {
                alert('ÌÖçÏä§Ìä∏Î•º ÏûÖÎ†•Ìï¥Ï£ºÏÑ∏Ïöî.');
                return;
            }

            const t = TRANSLATIONS[currentLang];

            // MRZ ÌååÏã± ÏãúÎèÑ
            const mrzData = parseMRZ(text);

            // ÌÖçÏä§Ìä∏ Ï∂îÏ∂ú Ìï®Ïàò Ìò∏Ï∂ú (MRZ Îç∞Ïù¥ÌÑ∞ Ìè¨Ìï®)
            extractAndFillForm(text, mrzData);

            // ÏÑ±Í≥µ Î©îÏãúÏßÄ
            const successMsg = document.getElementById('successMessage');
            if (mrzData.found) {
                successMsg.textContent = '‚úÖ MRZ Í∞êÏßÄ! Ï†ïÎ≥¥Í∞Ä Ï∂îÏ∂úÎêòÏóàÏäµÎãàÎã§.';
            } else {
                successMsg.textContent = t.extractSuccess;
            }
            successMsg.classList.add('show');
            setTimeout(() => {
                successMsg.classList.remove('show');
                successMsg.textContent = t.successMessage;
            }, 3000);

            // ÌÖçÏä§Ìä∏ ÏûÖÎ†•Ï∞Ω Ï¥àÍ∏∞Ìôî
            document.getElementById('textInput').value = '';
        }

        // Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú ÏòÅÏó≠ Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
        const uploadArea = document.getElementById('uploadArea');
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');
        const clearImageBtn = document.getElementById('clearImageBtn');
        const processingOverlay = document.getElementById('processingOverlay');

        // ÌÅ¥Î¶≠ÌïòÏó¨ ÌååÏùº ÏÑ†ÌÉù
        uploadArea.addEventListener('click', () => {
            imageInput.click();
        });

        // ÎìúÎûòÍ∑∏ Ïï§ ÎìúÎ°≠ Ïù¥Î≤§Ìä∏
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');

            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleImageUpload(files[0]);
            }
        });

        // ÌååÏùº ÏÑ†ÌÉù Ïù¥Î≤§Ìä∏
        imageInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleImageUpload(e.target.files[0]);
            }
        });

        // Ïù¥ÎØ∏ÏßÄ Ï†úÍ±∞ Î≤ÑÌäº
        clearImageBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            imagePreview.style.display = 'none';
            clearImageBtn.style.display = 'none';
            imageInput.value = '';
        });

        // Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú Ï≤òÎ¶¨
        async function handleImageUpload(file) {
            if (!file.type.startsWith('image/')) {
                alert('Ïù¥ÎØ∏ÏßÄ ÌååÏùºÎßå ÏóÖÎ°úÎìú Í∞ÄÎä•Ìï©ÎãàÎã§.');
                return;
            }

            // Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞
            const reader = new FileReader();
            reader.onload = (e) => {
                imagePreview.src = e.target.result;
                imagePreview.style.display = 'block';
                clearImageBtn.style.display = 'inline-block';
            };
            reader.readAsDataURL(file);

            // OCR Ï≤òÎ¶¨
            await performOCR(file);
        }

        // ========== Ïù¥ÎØ∏ÏßÄ Ï†ÑÏ≤òÎ¶¨ Ìï®ÏàòÎì§ ==========

        // Ïù¥ÎØ∏ÏßÄ Ï†ÑÏ≤òÎ¶¨ - Í∑∏Î†àÏù¥Ïä§ÏºÄÏùº, ÎåÄÎπÑ Ï°∞Ï†ï, ÏÉ§ÌîÑÎãù, Ïù¥ÏßÑÌôî
        async function preprocessImage(imageFile) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        // Canvas ÏÉùÏÑ±
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');

                        canvas.width = img.width;
                        canvas.height = img.height;

                        // ÏõêÎ≥∏ Ïù¥ÎØ∏ÏßÄ Í∑∏Î¶¨Í∏∞
                        ctx.drawImage(img, 0, 0);

                        // Ïù¥ÎØ∏ÏßÄ Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
                        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                        const data = imageData.data;

                        // 1Îã®Í≥Ñ: Í∑∏Î†àÏù¥Ïä§ÏºÄÏùº Î≥ÄÌôò
                        for (let i = 0; i < data.length; i += 4) {
                            const gray = data[i] * 0.299 + data[i + 1] * 0.587 + data[i + 2] * 0.114;
                            data[i] = data[i + 1] = data[i + 2] = gray;
                        }

                        // 2Îã®Í≥Ñ: ÎåÄÎπÑ Ï¶ùÍ∞Ä (contrast enhancement)
                        const contrast = 1.5; // ÎåÄÎπÑ Ï¶ùÍ∞Ä Í≥ÑÏàò
                        const factor = (259 * (contrast * 100 + 255)) / (255 * (259 - contrast * 100));

                        for (let i = 0; i < data.length; i += 4) {
                            data[i] = factor * (data[i] - 128) + 128;
                            data[i + 1] = factor * (data[i + 1] - 128) + 128;
                            data[i + 2] = factor * (data[i + 2] - 128) + 128;

                            // Í∞íÏùÑ 0-255 Î≤îÏúÑÎ°ú Ï†úÌïú
                            data[i] = Math.max(0, Math.min(255, data[i]));
                            data[i + 1] = Math.max(0, Math.min(255, data[i + 1]));
                            data[i + 2] = Math.max(0, Math.min(255, data[i + 2]));
                        }

                        // 3Îã®Í≥Ñ: Ïù¥ÏßÑÌôî (Otsu's method Îã®ÏàúÌôî Î≤ÑÏ†Ñ)
                        // ÌèâÍ∑† Î∞ùÍ∏∞ Í≥ÑÏÇ∞
                        let sum = 0;
                        for (let i = 0; i < data.length; i += 4) {
                            sum += data[i];
                        }
                        const threshold = sum / (data.length / 4);

                        // Ïù¥ÏßÑÌôî Ï†ÅÏö©
                        for (let i = 0; i < data.length; i += 4) {
                            const value = data[i] > threshold ? 255 : 0;
                            data[i] = data[i + 1] = data[i + 2] = value;
                        }

                        // Ï≤òÎ¶¨Îêú Ïù¥ÎØ∏ÏßÄ Îç∞Ïù¥ÌÑ∞ Îã§Ïãú Í∑∏Î¶¨Í∏∞
                        ctx.putImageData(imageData, 0, 0);

                        // CanvasÎ•º BlobÏúºÎ°ú Î≥ÄÌôò
                        canvas.toBlob((blob) => {
                            resolve(blob);
                        }, 'image/png');
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(imageFile);
            });
        }

        // MRZ (Machine Readable Zone) ÌååÏã± Ìï®Ïàò
        function parseMRZ(text) {
            // MRZ ÎùºÏù∏ Ï∞æÍ∏∞ (Ïó¨Í∂å/Ïã†Î∂ÑÏ¶ù ÌïòÎã®Ïùò Í∏∞Í≥ÑÌåêÎèÖÏòÅÏó≠)
            // ÌòïÏãù: IDKGZID3181390822301197900282<
            //      7901232M3301258KGZ<<<<<<<<<<<
            //      MATSAN<<KHAMID<<<<<<<<<<<<<<

            const lines = text.split('\n').map(line => line.trim());
            const mrzData = {
                found: false,
                passportNumber: '',
                surname: '',
                givenName: '',
                birthDate: '',
                expiryDate: '',
                nationality: ''
            };

            // MRZ Ìå®ÌÑ¥ Ï∞æÍ∏∞ (ID, P<, I<, AC Îì±ÏúºÎ°ú ÏãúÏûëÌïòÎäî ÎùºÏù∏)
            const mrzLines = lines.filter(line =>
                /^(ID|P<|I<|AC)[A-Z<]{3}/.test(line) ||
                /^[A-Z0-9<]{30,}$/.test(line)
            );

            if (mrzLines.length >= 2) {
                mrzData.found = true;

                // Ï≤´ Î≤àÏß∏ ÎùºÏù∏ÏóêÏÑú Ïó¨Í∂åÎ≤àÌò∏ Ï∂îÏ∂ú
                const line1 = mrzLines[0].replace(/\s/g, '');
                const passportMatch = line1.match(/ID([A-Z]{3})([A-Z0-9]{6,9})/);
                if (passportMatch) {
                    mrzData.nationality = passportMatch[1];
                    mrzData.passportNumber = passportMatch[2];
                }

                // Îëê Î≤àÏß∏ ÎùºÏù∏ÏóêÏÑú ÏÉùÎÖÑÏõîÏùº, ÎßåÎ£åÏùº Ï∂îÏ∂ú
                if (mrzLines[1]) {
                    const line2 = mrzLines[1].replace(/\s/g, '');
                    // ÏÉùÎÖÑÏõîÏùº (YYMMDD)
                    const birthMatch = line2.match(/^(\d{6})/);
                    if (birthMatch) {
                        const yy = birthMatch[1].substring(0, 2);
                        const mm = birthMatch[1].substring(2, 4);
                        const dd = birthMatch[1].substring(4, 6);
                        // 1900ÎÖÑÎåÄ/2000ÎÖÑÎåÄ ÌåêÎã® (70 Ïù¥ÏÉÅÏù¥Î©¥ 1900ÎÖÑÎåÄ)
                        const year = parseInt(yy) >= 70 ? '19' + yy : '20' + yy;
                        mrzData.birthDate = `${dd}.${mm}.${year}`;
                    }

                    // ÎßåÎ£åÏùº (YYMMDD)
                    const expiryMatch = line2.match(/\d[MF](\d{6})/);
                    if (expiryMatch) {
                        const yy = expiryMatch[1].substring(0, 2);
                        const mm = expiryMatch[1].substring(2, 4);
                        const dd = expiryMatch[1].substring(4, 6);
                        const year = parseInt(yy) >= 70 ? '19' + yy : '20' + yy;
                        mrzData.expiryDate = `${dd}.${mm}.${year}`;
                    }
                }

                // ÏÑ∏ Î≤àÏß∏ ÎùºÏù∏ÏóêÏÑú Ïù¥Î¶Ñ Ï∂îÏ∂ú
                if (mrzLines[2]) {
                    const line3 = mrzLines[2].replace(/\s/g, '');
                    // ÌòïÏãù: SURNAME<<GIVENNAME<<MIDDLENAME
                    const nameParts = line3.split('<<');
                    if (nameParts.length >= 2) {
                        mrzData.surname = nameParts[0].replace(/</g, ' ').trim();
                        mrzData.givenName = nameParts[1].replace(/</g, ' ').trim();
                    }
                }
            }

            return mrzData;
        }

        // OCR Ï≤òÎ¶¨ Ìï®Ïàò (Ï†ÑÏ≤òÎ¶¨ + MRZ Ï≤òÎ¶¨ Ìè¨Ìï®)
        async function performOCR(imageFile) {
            const t = TRANSLATIONS[currentLang];
            processingOverlay.classList.add('show');
            document.querySelector('.processing-text').textContent = `${t.processing} 0%`;

            try {
                // 1Îã®Í≥Ñ: Ïù¥ÎØ∏ÏßÄ Ï†ÑÏ≤òÎ¶¨
                console.log('Ïù¥ÎØ∏ÏßÄ Ï†ÑÏ≤òÎ¶¨ ÏãúÏûë...');
                document.querySelector('.processing-text').textContent = 'Ïù¥ÎØ∏ÏßÄ Ï†ÑÏ≤òÎ¶¨ Ï§ë...';
                const preprocessedImage = await preprocessImage(imageFile);

                // 2Îã®Í≥Ñ: ÏõêÎ≥∏ Ïù¥ÎØ∏ÏßÄÎ°ú OCR (ÏùºÎ∞ò ÌÖçÏä§Ìä∏Ïö©)
                console.log('ÏõêÎ≥∏ Ïù¥ÎØ∏ÏßÄ OCR ÏãúÏûë...');
                document.querySelector('.processing-text').textContent = 'ÏõêÎ≥∏ Ïù¥ÎØ∏ÏßÄ Î∂ÑÏÑù Ï§ë... 0%';

                const originalResult = await Tesseract.recognize(
                    imageFile,
                    'rus+eng', // Îü¨ÏãúÏïÑÏñ¥ + ÏòÅÏñ¥
                    {
                        logger: info => {
                            if (info.status === 'recognizing text') {
                                const progress = Math.round(info.progress * 50);
                                document.querySelector('.processing-text').textContent =
                                    `ÏõêÎ≥∏ Ïù¥ÎØ∏ÏßÄ Î∂ÑÏÑù Ï§ë... ${progress}%`;
                            }
                        }
                    }
                );

                // 3Îã®Í≥Ñ: Ï†ÑÏ≤òÎ¶¨Îêú Ïù¥ÎØ∏ÏßÄÎ°ú OCR (MRZ Î∞è Ïñ¥Î†§Ïö¥ ÌÖçÏä§Ìä∏Ïö©)
                console.log('Ï†ÑÏ≤òÎ¶¨Îêú Ïù¥ÎØ∏ÏßÄ OCR ÏãúÏûë...');
                document.querySelector('.processing-text').textContent = 'Ï†ÑÏ≤òÎ¶¨ Ïù¥ÎØ∏ÏßÄ Î∂ÑÏÑù Ï§ë... 50%';

                const preprocessedResult = await Tesseract.recognize(
                    preprocessedImage,
                    'rus+eng',
                    {
                        tessedit_pageseg_mode: Tesseract.PSM.AUTO,
                        tessedit_char_whitelist: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ–ê–ë–í–ì–î–ï–Å–ñ–ó–ò–ô–ö–õ–ú–ù–û–ü–†–°–¢–£–§–•–¶–ß–®–©–™–´–¨–≠–Æ–Ø–∞–±–≤–≥–¥–µ—ë–∂–∑–∏–π–∫–ª–º–Ω–æ–ø—Ä—Å—Ç—É—Ñ—Ö—Ü—á—à—â—ä—ã—å—ç—é—è0123456789<-/ ',
                        logger: info => {
                            if (info.status === 'recognizing text') {
                                const progress = Math.round(info.progress * 50) + 50;
                                document.querySelector('.processing-text').textContent =
                                    `Ï†ÑÏ≤òÎ¶¨ Ïù¥ÎØ∏ÏßÄ Î∂ÑÏÑù Ï§ë... ${progress}%`;
                            }
                        }
                    }
                );

                // Îëê Í≤∞Í≥º Í≤∞Ìï©
                const combinedText = originalResult.data.text + '\n' + preprocessedResult.data.text;
                console.log('Í≤∞Ìï©Îêú ÌÖçÏä§Ìä∏:', combinedText);

                // 4Îã®Í≥Ñ: MRZ ÌååÏã± ÏãúÎèÑ
                document.querySelector('.processing-text').textContent = 'MRZ Î∂ÑÏÑù Ï§ë...';
                const mrzData = parseMRZ(combinedText);

                // 5Îã®Í≥Ñ: Ìèº Ï±ÑÏö∞Í∏∞
                if (mrzData.found) {
                    console.log('MRZ Í∞êÏßÄÎê®:', mrzData);
                    // MRZ Îç∞Ïù¥ÌÑ∞Î°ú Ìèº Ï±ÑÏö∞Í∏∞
                    if (mrzData.passportNumber) {
                        document.getElementById('driverPassport').value = mrzData.passportNumber;
                    }
                    if (mrzData.surname && mrzData.givenName) {
                        document.getElementById('driverName').value =
                            `${mrzData.givenName} ${mrzData.surname}`;
                    }
                }

                // ÏùºÎ∞ò ÌÖçÏä§Ìä∏ ÌååÏã±ÎèÑ Ìï®Íªò ÏàòÌñâ (Ï∞®ÎüâÎ≤àÌò∏ Îì±)
                extractAndFillForm(combinedText, mrzData);

                processingOverlay.classList.remove('show');

                // ÏÑ±Í≥µ Î©îÏãúÏßÄ
                const successMsg = document.getElementById('successMessage');
                if (mrzData.found) {
                    successMsg.textContent = '‚úÖ MRZ Í∞êÏßÄ! Ï†ïÎ≥¥Í∞Ä Ï∂îÏ∂úÎêòÏóàÏäµÎãàÎã§.';
                } else {
                    successMsg.textContent = t.extractSuccess;
                }
                successMsg.classList.add('show');
                setTimeout(() => {
                    successMsg.classList.remove('show');
                    successMsg.textContent = t.successMessage;
                }, 3000);

            } catch (error) {
                console.error('OCR Ïò§Î•ò:', error);
                processingOverlay.classList.remove('show');
                alert(t.extractError + '\n' + error.message);
            }
        }

        // ÌÖçÏä§Ìä∏ÏóêÏÑú Ï†ïÎ≥¥ Ï∂îÏ∂ú Î∞è Ìèº Ï±ÑÏö∞Í∏∞ (MRZ Îç∞Ïù¥ÌÑ∞ Ìè¨Ìï®)
        function extractAndFillForm(text, mrzData = null) {
            console.log('Ï∂îÏ∂úÎêú ÌÖçÏä§Ìä∏:', text);
            if (mrzData && mrzData.found) {
                console.log('MRZ Îç∞Ïù¥ÌÑ∞ ÏÇ¨Ïö©:', mrzData);
            }

            const learningData = loadLearningData();
            const extractedData = {
                clientName: '',
                orderNumber: '',
                headNumber: '',
                trailerNumber: '',
                driverName: '',
                driverPassport: '',
                driverPhone: '',
                entryTime: ''
            };

            // Ïó¨Í∂å Î≤àÌò∏ - ÎùºÎ≤® Ìè¨Ìï® Ï≤òÎ¶¨ (–ü–∞—Å–ø–æ—Ä—Ç:, Passport: Îì±)
            // ÌÇ§Î¶¥ Î¨∏ÏûêÏôÄ ÎùºÌã¥ Î¨∏Ïûê Î™®Îëê ÏßÄÏõê
            let passportMatch = text.match(/(?:–ü–∞—Å–ø–æ—Ä—Ç|Passport|–ø–∞—Å–ø–æ—Ä—Ç|passport):\s*([A-Z–ê-–Ø–Å]{2}\s?\d{7,8})/i);
            if (!passportMatch) {
                // ÎùºÎ≤® ÏóÜÏù¥ Ìå®ÌÑ¥Îßå Ï∞æÍ∏∞
                passportMatch = text.match(/[A-Z–ê-–Ø–Å]{2}\s?\d{7,8}/i);
            }
            if (passportMatch) {
                let passport = (passportMatch[1] || passportMatch[0]).replace(/\s/g, '').toUpperCase();
                // ÌÇ§Î¶¥ Î¨∏ÏûêÎ•º ÎùºÌã¥ Î¨∏ÏûêÎ°ú Î≥ÄÌôò (–ú->M, –°->C, –ù->H Îì±)
                passport = passport.replace(/–ú/g, 'M').replace(/–°/g, 'C').replace(/–ù/g, 'H')
                    .replace(/–ê/g, 'A').replace(/–í/g, 'B').replace(/–ï/g, 'E')
                    .replace(/–ö/g, 'K').replace(/–û/g, 'O').replace(/–†/g, 'P')
                    .replace(/–¢/g, 'T').replace(/–•/g, 'X');

                // ÌïôÏäµÎêú Ìå®ÌÑ¥ Ï†ÅÏö©
                if (learningData.passportMappings[passport]) {
                    passport = learningData.passportMappings[passport];
                }
                extractedData.driverPassport = passport;
                document.getElementById('driverPassport').value = passport;
            }

            // Ï∞®Îüâ Î≤àÌò∏ Ìå®ÌÑ¥ (Ïòà: AX3623-5, A39101-5, A3910I-5)
            // IÎ•º 1Î°ú ÏûêÎèô Î≥ÄÌôò
            const vehicleMatches = text.match(/[A-Z]{1,2}\d{4,5}[-\s\/]?\d{1}|[A-Z]{1,2}\d{3,4}[I1][-\s\/]?\d{1}/gi);
            if (vehicleMatches && vehicleMatches.length >= 1) {
                // Ï≤´ Î≤àÏß∏Î•º Ìó§ÎìúÎ°ú (IÎ•º 1Î°ú Î≥ÄÌôò)
                extractedData.headNumber = vehicleMatches[0].replace(/\s/g, '').replace(/\//g, '').replace(/I/gi, '1');
                document.getElementById('headNumber').value = extractedData.headNumber;
                // Îëê Î≤àÏß∏Í∞Ä ÏûàÏúºÎ©¥ Ìä∏Î†àÏùºÎü¨Î°ú
                if (vehicleMatches.length >= 2) {
                    extractedData.trailerNumber = vehicleMatches[1].replace(/\s/g, '').replace(/\//g, '').replace(/I/gi, '1');
                    document.getElementById('trailerNumber').value = extractedData.trailerNumber;
                }
            }

            // Ïö¥Ï†ÑÏûê Ïù¥Î¶Ñ - ÎùºÎ≤® Ìè¨Ìï® Ï≤òÎ¶¨
            // –§–∞–º–∏–ª–∏—è:, –ò–º—è:, –û—Ç—á–µ—Å—Ç–≤–æ: ÌòïÏãù Ï≤òÎ¶¨
            let surname = '', firstName = '', patronymic = '';

            const surnameMatch = text.match(/(?:–§–∞–º–∏–ª–∏—è|Surname|—Ñ–∞–º–∏–ª–∏—è):\s*([–ê-–Ø–Å][–∞-—è—ë]+)/i);
            if (surnameMatch) surname = surnameMatch[1];

            const firstNameMatch = text.match(/(?:–ò–º—è|Name|–∏–º—è):\s*([–ê-–Ø–Å][–∞-—è—ë]+)/i);
            if (firstNameMatch) firstName = firstNameMatch[1];

            const patronymicMatch = text.match(/(?:–û—Ç—á–µ—Å—Ç–≤–æ|Patronymic|–æ—Ç—á–µ—Å—Ç–≤–æ):\s*([–ê-–Ø–Å][–∞-—è—ë]+)/i);
            if (patronymicMatch) patronymic = patronymicMatch[1];

            // ÎùºÎ≤®Ïù¥ ÏûàÎäî Í≤ΩÏö∞
            if (surname && firstName && patronymic) {
                let fullName = `${surname} ${firstName} ${patronymic}`;
                // ÌïôÏäµÎêú Ìå®ÌÑ¥ Ï†ÅÏö©
                if (learningData.nameMappings[fullName]) {
                    fullName = learningData.nameMappings[fullName];
                }
                extractedData.driverName = fullName;
                document.getElementById('driverName').value = fullName;
            } else {
                // ÎùºÎ≤® ÏóÜÏù¥ Ïó∞ÏÜçÎêú 3Îã®Ïñ¥ Ìå®ÌÑ¥ Ï∞æÍ∏∞
                const nameMatch = text.match(/([–ê-–Ø–Å][–∞-—è—ë]+)\s+([–ê-–Ø–Å][–∞-—è—ë]+)\s+([–ê-–Ø–Å][–∞-—è—ë]+)/);
                if (nameMatch) {
                    let fullName = `${nameMatch[1]} ${nameMatch[2]} ${nameMatch[3]}`;
                    // ÌïôÏäµÎêú Ìå®ÌÑ¥ Ï†ÅÏö©
                    if (learningData.nameMappings[fullName]) {
                        fullName = learningData.nameMappings[fullName];
                    }
                    extractedData.driverName = fullName;
                    document.getElementById('driverName').value = fullName;
                }
            }

            // Í±∞ÎûòÏ≤òÎ™Ö - ÌïôÏäµÎêú Ìå®ÌÑ¥ Ïö∞ÏÑ† Ï†ÅÏö©
            let clientName = '';
            const keywords = extractClientKeywords(text);
            for (const keyword of keywords) {
                if (learningData.clientMappings[keyword]) {
                    clientName = learningData.clientMappings[keyword];
                    break;
                }
            }
            // ÌïôÏäµÎêú Ìå®ÌÑ¥Ïù¥ ÏóÜÏúºÎ©¥ Í∏∞Î≥∏ Ìå®ÌÑ¥ ÏÇ¨Ïö©
            if (!clientName) {
                const clientMatch = text.match(/(?:–õ–û–¢–¢–ï|LOTTE|–õ–û[T–¢]{2}–ï)/i);
                if (clientMatch) {
                    clientName = '–õ–û–¢–¢–ï';
                }
            }
            if (clientName) {
                extractedData.clientName = clientName;
                document.getElementById('clientName').value = clientName;
            }

            // ÎÇ†Ïßú - "–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:" ÎùºÎ≤® Î¨¥ÏãúÌïòÍ≥† ÎÇ†ÏßúÎßå Ï∂îÏ∂ú
            // Ïò§Îäò ÎÇ†ÏßúÎ•º Í∏∞Î≥∏ÏúºÎ°ú ÏÇ¨Ïö© (ÏÉùÎÖÑÏõîÏùºÏù¥ ÏïÑÎãå ÏûÖÏ∞® ÎÇ†ÏßúÍ∞Ä ÌïÑÏöîÌï®)
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('entryDate').value = today;

            // ÎßåÏïΩ ÌÖçÏä§Ìä∏Ïóê ÏûÖÏ∞® ÎÇ†ÏßúÍ∞Ä Î™ÖÏãúÎêòÏñ¥ ÏûàÎã§Î©¥ Ï∂îÏ∂ú
            const entryDateMatch = text.match(/(?:–î–∞—Ç–∞|Date|–¥–∞—Ç–∞|date)(?:\s+–≤—ä–µ–∑–¥–∞|\s+entry)?:\s*(\d{1,2})[.\-\/](\d{1,2})[.\-\/](\d{2,4})/i);
            if (entryDateMatch) {
                let day = entryDateMatch[1].padStart(2, '0');
                let month = entryDateMatch[2].padStart(2, '0');
                let year = entryDateMatch[3];
                if (year.length === 2) {
                    year = '20' + year;
                }
                document.getElementById('entryDate').value = `${year}-${month}-${day}`;
            }

            // Ï†ÑÌôîÎ≤àÌò∏ (Îü¨ÏãúÏïÑ ÌòïÏãù: +7 –∏–ª–∏ 8)
            const phoneMatch = text.match(/(?:\+7|8)\s?[\d\s\-()]{10,}/);
            if (phoneMatch) {
                let phone = phoneMatch[0].replace(/[\s\-()]/g, '');
                // +7 ÌòïÏãùÏúºÎ°ú ÌÜµÏùº
                if (phone.startsWith('8')) {
                    phone = '+7' + phone.substring(1);
                }
                extractedData.driverPhone = phone;
                document.getElementById('driverPhone').value = phone;
            }

            // Ï£ºÎ¨∏Î≤àÌò∏ Ìå®ÌÑ¥ - ÌïôÏäµÎêú Ìå®ÌÑ¥ Ïö∞ÏÑ† Ï†ÅÏö©
            let orderNumber = '';
            for (const pattern in learningData.orderMappings) {
                if (text.includes(pattern)) {
                    orderNumber = learningData.orderMappings[pattern];
                    break;
                }
            }
            // ÌïôÏäµÎêú Ìå®ÌÑ¥Ïù¥ ÏóÜÏúºÎ©¥ Í∏∞Î≥∏ Ìå®ÌÑ¥ ÏÇ¨Ïö©
            if (!orderNumber) {
                const orderMatch = text.match(/(?:‚Ññ|#|N)\s?([A-Z0-9]+\/\d+|[A-Z]?\d+\/\d+)/i);
                if (orderMatch) {
                    orderNumber = orderMatch[1];
                }
            }
            if (orderNumber) {
                extractedData.orderNumber = orderNumber;
                document.getElementById('orderNumber').value = orderNumber;
            }

            // Ï∂îÏ∂úÎêú Îç∞Ïù¥ÌÑ∞ÏôÄ ÏõêÎ≥∏ ÌÖçÏä§Ìä∏ Ï†ÄÏû• (ÌïôÏäµÏö©)
            localStorage.setItem(STORAGE_KEYS.lastOcrExtraction, JSON.stringify({
                originalText: text,
                extractedData: extractedData,
                timestamp: new Date().toISOString()
            }));
        }

        // Ïã§ÏãúÍ∞Ñ ÎÇ†Ïßú/ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏
        function updateDateTime() {
            try {
                // Î™®Ïä§ÌÅ¨Î∞î ÏãúÍ∞ÑÎåÄ (UTC+3)
                const now = new Date();
                const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
                const moscowTime = new Date(utc + (3 * 3600000)); // UTC+3

                // ÎÇ†Ïßú ÌòïÏãù (Îü¨ÏãúÏïÑÏñ¥/ÌïúÍµ≠Ïñ¥)
                let dateStr;
                if (currentLang === 'ru') {
                    const months = ['—è–Ω–≤–∞—Ä—è', '—Ñ–µ–≤—Ä–∞–ª—è', '–º–∞—Ä—Ç–∞', '–∞–ø—Ä–µ–ª—è', '–º–∞—è', '–∏—é–Ω—è',
                        '–∏—é–ª—è', '–∞–≤–≥—É—Å—Ç–∞', '—Å–µ–Ω—Ç—è–±—Ä—è', '–æ–∫—Ç—è–±—Ä—è', '–Ω–æ—è–±—Ä—è', '–¥–µ–∫–∞–±—Ä—è'];
                    dateStr = `${moscowTime.getDate()} ${months[moscowTime.getMonth()]} ${moscowTime.getFullYear()} –≥.`;
                } else {
                    dateStr = `${moscowTime.getFullYear()}ÎÖÑ ${(moscowTime.getMonth() + 1)}Ïõî ${moscowTime.getDate()}Ïùº`;
                }

                // ÏãúÍ∞Ñ ÌòïÏãù (24ÏãúÍ∞Ñ)
                const hours = String(moscowTime.getHours()).padStart(2, '0');
                const minutes = String(moscowTime.getMinutes()).padStart(2, '0');
                const seconds = String(moscowTime.getSeconds()).padStart(2, '0');
                const timeStr = `${hours}:${minutes}:${seconds}`;

                // DOM ÏóÖÎç∞Ïù¥Ìä∏
                const dateElement = document.getElementById('currentDate');
                const timeElement = document.getElementById('currentTime');

                if (dateElement) dateElement.textContent = dateStr;
                if (timeElement) timeElement.textContent = timeStr;

                console.log('DateTime updated (Moscow UTC+3):', dateStr, timeStr);
            } catch (error) {
                console.error('updateDateTime error:', error);
                // Ïò§Î•ò Î∞úÏÉù ÏãúÏóêÎèÑ Î™®Ïä§ÌÅ¨Î∞î ÏãúÍ∞Ñ ÌëúÏãú
                const now = new Date();
                const utc = now.getTime() + (now.getTimezoneOffset() * 60000);
                const moscowTime = new Date(utc + (3 * 3600000));
                const dateElement = document.getElementById('currentDate');
                const timeElement = document.getElementById('currentTime');
                if (dateElement) dateElement.textContent = moscowTime.toLocaleDateString('ru-RU');
                if (timeElement) timeElement.textContent = moscowTime.toLocaleTimeString('ru-RU');
            }
        }

        // Ï¥àÍ∏∞Ìôî
        window.addEventListener('load', function () {
            // Î°úÍ∑∏Ïù∏ Ìèº Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà
            document.getElementById('loginForm').addEventListener('submit', handleLogin);

            // Ï†ÄÏû•Îêú Ïñ∏Ïñ¥ Î∂àÎü¨Ïò§Í∏∞
            const savedLang = localStorage.getItem(STORAGE_KEYS.language) || 'ru';
            currentLang = savedLang;

            // Ïñ∏Ïñ¥ Î≤ÑÌäº ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if ((savedLang === 'ru' && btn.textContent === 'RUS') ||
                    (savedLang === 'ko' && btn.textContent === 'KOR')) {
                    btn.classList.add('active');
                }
            });

            // Ïñ∏Ïñ¥ Ï†ÅÏö©
            console.log('Applying language...');
            updateLanguage();

            // ÎÇ†Ïßú/ÏãúÍ∞Ñ Ï¶âÏãú ÏóÖÎç∞Ïù¥Ìä∏ Î∞è ÏãúÏûë
            console.log('Starting datetime update...');
            updateDateTime();
            if (dateTimeInterval) clearInterval(dateTimeInterval);
            dateTimeInterval = setInterval(updateDateTime, 1000);
            console.log('DateTime interval started');

            // Î°úÍ∑∏Ïù∏ ÏÉÅÌÉú ÌôïÏù∏
            console.log('Checking login status...');
            checkLoginStatus();

            renderUserSelect();

            // Ïò§Îäò ÎÇ†Ïßú ÏûêÎèô ÏÑ§Ï†ï
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('entryDate').value = today;
        });
    </script>
</body>

</html>